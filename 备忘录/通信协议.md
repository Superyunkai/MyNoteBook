### 封装格式

| 核新头 | 数据头 | 数据段 | 文本段 |
| ------ | ------ | ------ | ------ |
|        |        |        |        |

### 核新头

| Bytes | Description | Value                        |       Comment        |
| ----- | ----------- | ---------------------------- | :------------------: |
| 4     | 核新标识    | 0xfdfdfdfd                   |                      |
| 8     | 长度        | 数据头+数据段+文本段         |        16进制        |
| 1     | 压缩标识    | 0x00：不压缩<br />0x0a：压缩 | 一般不压缩除mobisync |

### 数据头

| Bytes | Description             | Value | Comments                                                     |
| ----- | ----------------------- | ----- | ------------------------------------------------------------ |
| 2     | 数据头长度              |       |                                                              |
| 4     | 包序号                  |       | 递增                                                         |
| 2     | 功能号pageId/instanceId |       | 请求包为pageI  <br /> 应答包为instanceId        <br /> 文本请求中该字段无效，采用文本段中的id作为PageId |
| 4     | 数据段长度              |       |                                                              |
| 4     | frameId                 |       | 手机网关转发数据                                             |
| 4     | 文本段长度              |       |                                                              |
| 2     | 上个响应包的frammId     |       | 可选                                                         |
| 2     | 上个响应包的处理时间    |       | 可选                                                         |

### 数据类型

| Bytes | description | Value                                                        | Comment        | Value(respond) |
| ----- | ----------- | ------------------------------------------------------------ | -------------- | -------------- |
| 4     | 命令号(cmd) |                                                              | 响应包主要属性 |                |
| 4     | 命令号      |                                                              | 格式次要属性   |                |
| 4     | 命令号      |                                                              | 辅助属性       |                |
| 4     | 命令号      |                                                              | 压缩格式       |                |
| 8     | 请求类型    |                                                              | 无             | 无             |
| 4     | 标识号      | 第一位：字符编码<br />0标识unicode<br />1标识GBK<br />第二位：委托类型<br />0表示普通交易<br />1表示独立委托<br />高2位：保留 | 附加属性       |                |
| 4     | 加密方式    |                                                              |                | 同请求         |

### 加密方式

| 说明 | 宏                                 | 值         | 描述                             |
| ---- | ---------------------------------- | ---------- | -------------------------------- |
| 掩码 | USER_PACKET_CRYPT_MASK             | 0xf0000000 |                                  |
| 取值 | USER_PACKET_CRYPT_NONE             | 0x00000000 | 未加密                           |
|      | USER_PACKET_CRYPT_DES              | 0x10000000 | DES加密                          |
|      | USER_PACKET_CRYPT_RSA              | 0x20000000 | RSA加密                          |
|      | USER_PACKET_CRYPT_NOT              | 0x30000000 | 取反                             |
|      | USER_PACKET_CRYPT_XOR              | 0x40000000 | 异或                             |
|      | USER_PACKET_CRYPT_RAS_DES          | 0x50000000 | RSADES混合加密                   |
|      | USER_PACKET_CRYPT_RAS_DES_NOT_SAVE | 0x60000000 | RSADES混合加密。主站不保存该密钥 |

### 重要概念

type:请求或应答的协议格式

instanceId:客户端自动生成，用于客户端匹配应答

frameId: 业务标识，用于网关转发和问题排查，同一个业务可以有多个frameId

pageId：业务标识，服务器用于处理区分业务

CommandId：业务子标识，服务器用于处理区分业务

